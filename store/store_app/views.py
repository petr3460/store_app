from django.shortcuts import renderfrom store_app.models import *from django.http import JsonResponsefrom django.views.decorators.csrf import csrf_exemptimport jsonfrom django.http import Http404import datetime# Create your views here.def home(request):    stores = Store.objects.all()    goods = Product.objects.all()    cars = Car.objects.filter(busy=False)    context = {        'stores': stores,        'goods': goods,        'cars': cars    }    return render(request, 'home.html', context)@csrf_exemptdef show_products(request):    store_id = request.POST.get('store')    # store = Store.objects.get    storage_cons = StorageCons.objects.filter(store__id=store_id)    if not storage_cons:        return JsonResponse({'message': 'склад пуст'})    consignments = [i.consignment for i in storage_cons if i.consignment.quantity != 0]    if not consignments:        return JsonResponse({'message': 'склад пуст'})    response = {        'products': [            {                'name': cons.product.name,                'quantity': cons.quantity,                'date': cons.manufacture_date,                'price': cons.cost,                'total': int(cons.quantity) * int(cons.cost)            } for cons in consignments        ]    }    response['total'] = sum([p['total'] for p in response['products']])    return JsonResponse(response)### @csrf_exempt# def get_products(request):##     store_id = int(request.POST.get('store'))#     store = Store.objects.get(id=store_id)#     store_products = Consignment.objects.filter(storage=store)#     response = {#             cons.id : {#                 'name': cons.product.name,#                 'date': cons.manufacture_date,#                 'count': cons.quantity,#                 'cost': cons.cost#             } for cons in store_products##         }##     # import pdb#     # pdb.set_trace()#     return JsonResponse(response)## @csrf_exempt# def add_products(request):##     request_data = json.loads(request.body)#     store_id = request_data.get('store')#     store = Store.objects.get(id=store_id)#     car_id = request_data.get('car')#     car = Car.objects.get(id=car_id)#     shipping = Shipping()#     shipping.car = car#     shipping.destination = store#     shipping.save()#     for good in request_data.get('goods'):#         product = Product.objects.get(id=good['id'])#         cons = Consignment()#         cons.product = product#         cons.manufacture_date = good['date']#         cons.quantity = good['count']#         cons.cost = good['price']#         cons.save()#         ship_cons = ShippingCons()#         ship_cons.shipping = shipping#         ship_cons.consignment = cons#         ship_cons.save()##     return JsonResponse({'status': 'ok'})