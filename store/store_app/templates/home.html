<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <style>
        body {
            color: #0C3C26;
           }
    </style>
    <!--<script>-->
        <!--const GOODS = {-->
            <!--{% for good in goods %}-->
                <!--{{ good.id }}: {-->
                 <!--'name': '{{ good.name }}',-->
                 <!--'vendor_code': '{{ good.vendor_code }}',-->
                 <!--'vendor_code': '{{ good.vendor_code }}',-->
                 <!--'expiration': {{ good.expiration }},-->
                 <!--'weight': {{ good.weight }},-->
                 <!--},-->
            <!--{% endfor %}-->
        <!--}-->
        <!--const CARS = {-->
            <!--{% for car in cars %}-->
                <!--{{ car.id }}: {-->
                 <!--'brand': '{{ car.brand }}',-->
                 <!--'carrying': '{{ car.carrying }}',-->
                 <!--},-->
            <!--{% endfor %}-->
        <!--}-->

        <!--var products_send_data = {-->
            <!--'store': null,-->
            <!--'car': null,-->
            <!--'goods': []-->
        <!--}-->
        <!--var weight_goods = 0;-->
    <!--</script>-->
</head>
<body>
<!--<div class="container">-->
    <!--<div class="row m-5">-->
        <!--<h1>Пополнение складов</h1>-->
    <!--</div>-->
    <!--<div class="row m-5">-->
        <!--<h4>Выберите машину</h4>-->
        <!--<select name="" id="cars_select">-->
            <!--{% for car in cars %}-->
                <!--<option value="{{ car.id }}">{{ car.brand }}(грузоподьемность {{ car.carrying }} кг)</option>-->
            <!--{% endfor %}-->
        <!--</select>-->
    <!--</div>-->
    <!--<div class="row m-5">-->
        <!--<h4>Выберите товар</h4>-->
        <!--<select name="" id="goods_select">-->
            <!--{% for good in goods %}-->
                <!--<option value="{{ good.id }}">{{ good.name }}</option>-->
            <!--{% endfor %}-->
        <!--</select>-->
    <!--</div>-->
    <!--<div class="row m-3">-->
        <!--<h4>выберите количество</h4>-->
        <!--<input type="number" id="good_count">-->
    <!--</div>-->
    <!--<div class="row m-3">-->
        <!--<h4>введите дату изготовления</h4>-->
        <!--<input type="date" id="prod_date">-->
    <!--</div>-->
    <!--<div class="row m-3">-->
        <!--<h4>введите цену одного товара</h4>-->
        <!--<input type="number" id="prod_price">-->
    <!--</div>-->
    <!--<div class="row m-3">-->
        <!--<button id="add_to_car">Добавить в машину</button>-->
    <!--</div>-->
    <!--<script>-->
        <!--$('#add_to_car').on('click', function() {-->
            <!--var selected_good = $('#goods_select').val();-->
            <!--var count_goods = $('#good_count').val();-->
            <!--var date_goods = $('#prod_date').val();-->
            <!--var price_goods = $('#prod_price').val();-->
            <!--weight_goods += count_goods * GOODS[selected_good]['weight'] / 1000;-->
            <!--products_send_data.goods.push({-->
                <!--'id': selected_good,-->
                <!--'count': count_goods,-->
                <!--'date': date_goods,-->
                <!--'price': price_goods-->
            <!--})-->
            <!--$('#weight_selected').text(weight_goods);-->
            <!--products_send_data['car'] = $('#cars_select').val();-->
            <!--$('#send_to_store').css('cssText', 'display:initial');-->
        <!--})-->
    <!--</script>-->
    <!--<div class="row m-5">-->
        <!--<select name="" id="stores_select_add">-->
            <!--{% for store in stores %}-->
                <!--<option value="{{ store.id }}">{{ store.name }}</option>-->
            <!--{% endfor %}-->
        <!--</select>-->
    <!--</div>-->
    <!--<div class="row m-3">-->
        <!--<div id="weight_selected">0</div> кг выбрано-->
    <!--</div>-->
    <!--<div class="row m-3">-->
        <!--<button id="reset_car">сбросить</button>-->
    <!--</div>-->
    <!--<script>-->
        <!--$('#reset_car').on('click', function() {-->
            <!--products_send_data.goods = [];-->
            <!--products_send_data.car = null;-->
            <!--weight_goods = 0;-->
            <!--$('#weight_selected').text(weight_goods);-->
            <!--$('#send_to_store').css('cssText', 'display:none');-->
        <!--})-->
    <!--</script>-->
    <!--<div class="row m-3">-->
        <!--<button id="send_to_store" style="display:none">Отправить на склад</button>-->
    <!--</div>-->
    <!--<script>-->
        <!--$('#send_to_store').on('click', function() {-->
            <!--if (CARS[products_send_data['car']]['carrying'] < weight_goods) {-->
                <!--alert('в машину столько не влезет ((');-->
            <!--}-->
            <!--else {-->
                <!--products_send_data['store'] = $('#stores_select_add').val();-->
                <!--$.ajax({-->
                  <!--type: "POST",-->
                  <!--url: "/add_products/",-->
                  <!--data: JSON.stringify(products_send_data),-->
                  <!--dataType: "json",-->
                  <!--success: function(response) {-->
                    <!--}-->
              <!--});-->
            <!--}-->
        <!--})-->
    <!--</script>-->

<!--</div>-->


<div class="container">
    <div class="row m-5">
        <h1>Просмотр товаров на складе</h1>
    </div>
    <div class="row m-5">
        <h4>Выберите склад</h4>
        <select name="" id="stores_select">
            {% for store in stores %}
                <option value="{{ store.id }}">{{ store.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="row m-5">
        <button id="show_goods">Показать товары</button>
    </div>
    <div id="goods_list" class="container"></div>

</div>
<script>
    $('#show_goods').on('click', function() {
    var container = $('#goods_list');
    container.html('');
    var table = document.createElement('TABLE');
    var table_body = document.createElement('TBODY');
    table.border = '1';
    table.appendChild(table_body);

    var heading = new Array();
    heading[0] = "товар";
    heading[1] = "количество";
    heading[2] = "дата изготовления";
    heading[3] = "цена";
    heading[4] = "стоимость";

    $.ajax({
        type: "POST",
        url: "/show_products/",
        data: 'store=' + $('#stores_select').val(),
        dataType: "json",
        success: function(response) {
            if (response.message) {
            message = $('<h6>' + response.message + '</h6>');
            container.append(message);
            } else {
            var goods = new Array();
            for (var i=0; i<response['products'].length; i++) {
                goods[i] = new Array(
                    response['products'][i]['name'],
                    response['products'][i]['quantity'],
                    response['products'][i]['date'],
                    response['products'][i]['price'],
                    response['products'][i]['total']
                );
            }
            var tr = document.createElement('TR');
            table_body.appendChild(tr);
            for (i = 0; i < heading.length; i++) {
                var th = document.createElement('TH')
                th.width = '75';
                th.appendChild(document.createTextNode(heading[i]));
                tr.appendChild(th);
            }

            for (i = 0; i < goods.length; i++) {
                var tr = document.createElement('TR');
                for (j = 0; j < goods[i].length; j++) {
                    var td = document.createElement('TD')
                    td.appendChild(document.createTextNode(goods[i][j]));
                    tr.appendChild(td)
                }
                table_body.appendChild(tr);
            }
            container.append(table);
            var total = $('<h3>Итого: ' + response['total'] + '</h3>');

            container.append(total);
        }
        }
        });
    })
</script>



</body>
</html>